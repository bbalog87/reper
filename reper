#!/bin/bash

# This script is used to start reper
# call this script as
# reper <job>
# with <job> as the next part to execute (kmerCount, kmerFilter, assembly, cluster, classify, quantify, landscape)
# the jobs following the givien one are executed automatically


## read config
source ./reper.conf
export reperDir
ulimit -v "$maxMemoryKB"

## define next job
nextJob="$1"

## run scripts
case "$nextJob" in
    kmerCount) "$scrDir"/01_kmerCount.sh
	   exit 0
	   ;;
    kmerFilter) "$scrDir"/02_kmerFilter.sh
		exit 0
		;;
    assembly) "$scrDir"/03_assembly.sh
	     exit 0
	     ;;
    cluster) "$scrDir"/04_cluster.sh 
	     exit 0
	     ;;
    classify) "$scrDir"/05_classifiy.sh
	      exit 0
	      ;;
    quantify) "$scrDir"/06_quantify.sh 
	      exit 0
	      ;;
    landscape) "$scrDir"/07_landscape.pl --clstr "$CLUSTEROUT".clstr --fasta "$CLASSIFYOUT" --bam "$QUANTOUT" --coverage "$COVERAGE" --samtools "$samtools"
	       exit 0
	       ;;
    configure-REdat) "$scrDir"/configure-REdat.sh
		     exit 0
		     ;;
    configure-refseq) "$scrDir"/configure-refseq.sh
		     exit 0
		     ;;
    configure-repbase) mkdir -p "$3"
		       perl "$scrDir"/configure-repbase.pl "$2" "$3" "$4"
		       "$makeblastdb" -dbtype 'nucl' -in "$2".fa
		       exit 0
		       ;;
    print-env) echo "#####################"
	       echo "printing variables"
	       echo "reperDir: $reperDir"
	       echo "conf-file: "$(realpath reper.conf)
	       echo "scrDir: $scrDir"
	       echo "depDir: $depDir"
	       echo "dbDir: $dbDir"
	       echo "max-CPU: $MAXTHREADS"
	       echo "max-MEM: $MAXMEMORY"
	       echo "input: $READS1 $READS2"
	       exit 0
	       ;;
    *) echo "$STARTJOB is not a valid job name!"
       echo "please select one of the following:"
       echo "kmerCount, kmerFilter, assembly, cluster, classify, quantify, landscape"
       echo "run reper help for more info"
       exit 1
       ;;
esac

